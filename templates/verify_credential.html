{% extends "base.html" %}

{% block title %}Verify Credential - Blockchain Identity Verification{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Verify Credential</h1>
    <p>Verify the authenticity of a credential</p>
</div>

<div class="form-container">
    <form id="verify-credential-form">
        <div class="form-group">
            <label for="credential-id">Credential ID *</label>
            <input type="text" id="credential-id" name="credential_id" required placeholder="Enter credential ID">
        </div>
        
        <div class="form-group">
            <label for="verifier-did">Verifier DID (Optional)</label>
            <input type="text" id="verifier-did" name="verifier_did" placeholder="did:identity:...">
        </div>
        
        <button type="submit" class="btn btn-primary">Verify Credential</button>
    </form>
</div>

<div id="result" class="result-container" style="display: none;">
    <h3>Verification Result</h3>
    <div id="verification-result" class="result-box"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('verify-credential-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const credentialId = document.getElementById('credential-id').value;
        const verifierDid = document.getElementById('verifier-did').value;
        
        const requestData = verifierDid ? { verifier_did: verifierDid } : {};
        
        try {
            const response = await fetch(`/api/credential/verify/${credentialId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            });
            
            const data = await response.json();
            
            const resultDiv = document.getElementById('verification-result');
            
            if (data.valid) {
                resultDiv.innerHTML = `
                    <div class="success-box">
                        <h4>✅ Credential is Valid</h4>
                        <p><strong>Credential ID:</strong> ${data.credential_id}</p>
                        <p><strong>Type:</strong> ${data.credential_type}</p>
                        <p><strong>Issuer:</strong> ${data.issuer}</p>
                        <p><strong>Recipient:</strong> ${data.recipient}</p>
                        <p><strong>Issued At:</strong> ${new Date(data.issued_at * 1000).toLocaleString()}</p>
                        <hr>
                        <p><strong>Signature Valid:</strong> ${data.signature_valid ? '✅ Yes' : '❌ No'}</p>
                        <p><strong>Hash Valid:</strong> ${data.hash_valid ? '✅ Yes' : '❌ No'}</p>
                        <p><strong>Blockchain Valid:</strong> ${data.blockchain_valid ? '✅ Yes' : '❌ No'}</p>
                        <p><strong>Status:</strong> ${data.status}</p>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="error-box">
                        <h4>❌ Credential is Invalid</h4>
                        <p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>
                    </div>
                `;
            }
            
            document.getElementById('result').style.display = 'block';
        } catch (error) {
            alert('Error: ' + error.message);
        }
    });
</script>
{% endblock %}

