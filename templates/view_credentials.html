{% extends "base.html" %}

{% block title %}View Credentials - Blockchain Identity Verification{% endblock %}

{% block content %}
<div class="page-header">
    <h1>View Credentials</h1>
    <p>View all credentials for a specific DID</p>
</div>

<div class="form-container">
    <form id="view-credentials-form">
        <div class="form-group">
            <label for="did">DID *</label>
            <input type="text" id="did" name="did" required placeholder="did:identity:...">
            <small>Enter DID to view credentials (as recipient or issuer)</small>
        </div>
        
        <div class="form-group">
            <label>View As:</label>
            <div class="radio-group">
                <label><input type="radio" name="view_type" value="recipient" checked> Recipient</label>
                <label><input type="radio" name="view_type" value="issuer"> Issuer</label>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">View Credentials</button>
    </form>
</div>

<div id="result" class="result-container" style="display: none;">
    <h3>Credentials</h3>
    <div id="credentials-list" class="credentials-list"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('view-credentials-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const did = document.getElementById('did').value;
        const viewType = document.querySelector('input[name="view_type"]:checked').value;
        
        const endpoint = viewType === 'recipient' 
            ? `/api/credential/recipient/${did}`
            : `/api/credential/issuer/${did}`;
        
        try {
            const response = await fetch(endpoint);
            const data = await response.json();
            
            const listDiv = document.getElementById('credentials-list');
            
            if (data.success && data.credentials.length > 0) {
                let html = `<p><strong>Found ${data.credentials.length} credential(s):</strong></p>`;
                
                data.credentials.forEach(cred => {
                    html += `
                        <div class="credential-card">
                            <h4>${cred.credential_type}</h4>
                            <p><strong>Credential ID:</strong> ${cred.credential_id}</p>
                            <p><strong>Issuer:</strong> ${cred.issuer_name} (${cred.issuer_did})</p>
                            <p><strong>Recipient:</strong> ${cred.recipient_name} (${cred.recipient_did})</p>
                            <p><strong>Issued At:</strong> ${new Date(cred.issued_at * 1000).toLocaleString()}</p>
                            <p><strong>Status:</strong> ${cred.status}</p>
                            <details>
                                <summary>Credential Data</summary>
                                <pre>${JSON.stringify(cred.credential_data, null, 2)}</pre>
                            </details>
                            <details>
                                <summary>Credential Hash</summary>
                                <p class="hash-text">${cred.credential_hash}</p>
                            </details>
                        </div>
                    `;
                });
                
                listDiv.innerHTML = html;
            } else {
                listDiv.innerHTML = '<p>No credentials found for this DID.</p>';
            }
            
            document.getElementById('result').style.display = 'block';
        } catch (error) {
            alert('Error: ' + error.message);
        }
    });
</script>
{% endblock %}

